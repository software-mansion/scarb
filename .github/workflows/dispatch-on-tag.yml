name: Dispatch on New Tag

on:
  push:
    tags:
      # Matches only tags without any additional suffixes, like `-rc.0`.
      - "v[0-9]+.[0-9]+.[0-9]+"

jobs:
  dispatch:
    runs-on: ubuntu-latest
    steps:
      - name: Extract Tag Name
        id: tag_name
        run: echo "TAG_NAME=${{ github.ref_name }}" >> $GITHUB_OUTPUT

      - name: Repository Dispatch to Cairo lint repository
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.CAIRO_LINT_DISPATCH_TOKEN }}
          repository: "software-mansion/cairo-lint"
          event-type: "scarb-new-tag-published"
          client-payload: |
            {
              "tag": "${{ steps.tag_name.outputs.TAG_NAME }}",
            }
